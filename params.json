{"name":"Electric-eel-pond","tagline":"RNAseq pipeline for HPCC at MSU","body":"<a name=\"top\"></a>\r\nElectric Eelpond\r\n================\r\nWritten by Justin Rucinski and Sophia Sdao\r\n\r\n##Table of Contents\r\n* <a href=\"#step1\">Step 1- Cleaning the reads</a>\r\n* <a href=\"#step2\">Step 2- Running Trinity</a>\r\n* <a href=\"#step3\">Step 3- RSEM quantification</a>\r\n* <a href=\"#step4\">Step 4- mpiBLAST</a>\r\n\r\n\r\n<a name=\"step1\"></a>\r\n\r\n\r\n##Step 1- Cleaning the reads\r\n***\r\n\r\n###Overview:\r\nElectric Eelpond Step 1 removes adapter sequences, interleaves the paired ends, and quality filters the reads. \r\n\r\n###Command Arguments:\r\n\r\n*  `-h`, `--help`\r\n\r\n    Display help message and exit.\r\n\r\n- `-m`, `--msu`\r\n\r\n    Indicate using Michigan State University file naming convention.  Only valid in absence of `-c`. Default option.\r\n\r\n    Example Michigan State University file name: <br>__NAR_I_EO_AGTCAA_L001_R1_001.fastq.gz__\r\n\r\n* `-c`, `--cornell`\r\n\r\n    Indicate using Cornell University file naming convention.  Only valid in absence of `-m`.\r\n    \r\n    Example Cornell file name: <br>__468_3676_4104_N_PKINGN_6898_CCGTCC_R1.fastq.gz__  \r\n\r\n* `-s`, `--split`\r\n\r\n    Split paired reads into R1 and R2 files after quality filtering.\r\n\r\n* `-i`, `--inputdir` \\<path\\>\r\n\r\n   Name of input directory where files are located.\r\n\r\n* `-o`, `--outputdir` \\<path\\>\r\n\r\n    Name of output directory.  Does not have to exist prior to runtime.\r\n\r\n* `-t`, `--threads` \\<int\\>\r\n\r\n    Number of threads requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.  Default is 1 thread.\r\n\r\n* `-r`, `--reqmem` \\<int\\>\r\n\r\n    Gb of memory requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program. Default is 12Gb.\r\n\r\n* `-w`, `--walltime` \\<(h)h:mm:ss\\>\r\n\r\n    Estimated time required for job.  Enter as \"(h)h:mm:ss\".  Incorrect syntax will result in an error message followed by termination of the program. Default is 4:00:00.\r\n\r\n###Requirements:\r\n\r\n* The file names must follow the Msu or Cornell naming conventions.\r\n* Files must end in *.fastq.gz*\r\n* Files must be located inside the same folder.\r\n* One specimen per run\r\n\r\n###Process:\r\n\r\nElectric Eelpond Step 1 requires an input of a directory containing the fastq.gz files and returns quality trimmed and filtered gzipped files in the designated output directory.\r\n\r\n1. Creating the receipt\r\n\r\n    Step 1 will create a new text file named \"receipt.txt\" and save it to the output directory after documenting the date and time.\r\n\r\n2. Concatenating lanes\r\n\r\n    Step 1 will check for multiple lanes according to either the Michigan State University or Cornell University naming convention of fastq.gz files. Enter flag `-m` (or `--msu`) to indicate Michigan State University naming convention or `-c` (or `--cornell`) to indicate Cornell University naming convention.  Use of both `-m` and `-c` flags in the same command will result in an error message followed by termination of the program. Michigan State University convention will default when neither `-m` nor `-c` flags are specified in the command. If multiple lanes of a similar sample are found, Step 1 will concatenate the files together after prompting the user for confirmation of the concatenation process.  All prompts and responses will be written to the receipt.\r\n\r\n3. Writing the qsub script and submitting the job\r\n\r\n    After appropriate files have been concatenated, Step 1 will sort the files into R1 and R2 files and create a .qsub submission script.  The .qsub file will be named according to sample name and saved in the output directory.\r\n    Using the `-t`, `-r`, and `-w` flags in the command allows customization of number of cores, required memory, and walltime needed to complete the job.  Default number of cores is 1, default memory is 12Gb, and default walltime is 4 hours.  This information will be written to the receipt.\r\n    ####The qsub commands:\r\n      * Trimmomatic removes adapter sequences.\r\n      * Interleaves paired ends.\r\n      * Concatenates orphaned reads.\r\n      * Quality filter paired and single-end reads.\r\n      * Remove remaining orphaned reads.\r\n      * Cleans up directory such that only receipt.txt, `*.pe.qc.fq.gz` (paired-end reads), and `*.se.qc.fq.gz` (single-end reads) remain.  These are the final cleaned reads.\r\n      * If `-s` is called in command, splits paired reads (`*.pe.qc.fq.gz`) into R1 and R2 files. \r\n\r\n    Errors and outputs from each command in the qsub will be written to the receipt.\r\n\r\n<a href=\"#top\">Back to the top</a>\r\n\r\n<br>\r\n##Step 2- Running Trinity\r\n<a name=\"step2\"></a>\r\n\r\n***\r\n\r\n\r\n###Overview:\r\nSubmit files to Trinity for transcriptome assembly.\r\n\r\n###Command Arguments:\r\n* `-h`, `--help`\r\n\r\n    Display help message and exit.\r\n\r\n* `-n`, `--normalization`\r\n\r\n    Applies normalization to reads before running Trinity.\r\n\r\n* `-d`, `--inputdirs` \\<path(s)\\>\r\n\r\n    List of names of input directories to traverse.  At least one input directory required.  Only valid in absence of `-i`.\r\n\r\n* `-i`, `--inputfiles` \\<path(s)\\>\r\n\r\n    List of names of input files.  At least one input file required. Only valid in absence of `-d`.\r\n\r\n* `-o`, `--outputdir` \\<path\\>\r\n\r\n    Name of output directory.  Does not have to be created prior to runtime.\r\n\r\n* `-t`, `--threads` \\<int\\>\r\n\r\n    Number of threads requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-r`, `--reqmem` \\<int\\>\r\n\r\n    Gb of memory requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-w`, `--walltime` \\<(h)h:mm:ss\\>\r\n\r\n    Estimated time required for job.  Enter as \"(h)h:mm:ss\".  Incorrect syntax will result in an error message followed by termination of the program. Default is 20:00:00.\r\n\r\n\r\n###Process:\r\n\r\nElectric Eelpond Step 2 requires input in the form of either directories of quality filtered files or the quality filtered files themselves, and returns an assembled transcriptome in the designated output directory by calling an appropriate Trinity command. \r\n\r\n1. Creating the receipt\r\n\r\n    Step 2 will create a new text file named \"receipt.txt\" and save it to the output directory after documenting the date and time.\r\n\r\n2. Prompting for missing arguments\r\n\r\n    Unlike Step 1, Step 2 does not store default values for required memory and number of threads.  If \"-r\" and \"-t\" are not used in the command, Step 2 will prompt the user to enter values.  If walltime is not given, the default for walltime is 20 hours.  The option to wait to choose an amount of memory based on an estimation calculated by the program is given to the user.  This information is written to the receipt.\r\n\r\n3. Read recognition and sorting\r\n\r\n    Step 2 expects the reads to be separated into R1, R2 (each ending in \".fastq.gz.pe.qc.fq.gz\"), and single-ended reads (ending in \".fastq.gz.se.qc.fq.gz\").  If using Electric Eelpond Step 1 to quality filter, use of the \"-s\" flag in the Step 1 command will return these exact files.\r\n\r\n    If the \"-i\" is used in the command, Step 2 will sort only those input files into left, right, and single-ended reads.  If the \"-d\" is used instead, Step 2 will traverse all subdirectories within the input directories and find all files ending with \".fastq.gz.pe.qc.fq.gz\" and \".fastq.gz.se.qc.fq.gz\" and sort them into left, right, and single-ended files.  \r\n\r\n    Upon completion of the sorting, Step 2 will prompt the user for confirmation of correct sorting, as well as prompt for confirmation for use of single-ended files in Trinity.  When the user confirms, the names and directories of all files used are written to the receipt, and memory estimation commences if necessary.  The user will be given a recommended amount of memory to use in Gb, based on the rule: 1Gb per 1 million reads.  The choice of required memory is written to the receipt.\r\n\r\n4. Writing the qsub and submitting the job\r\n\r\n    At this point, Step 2 uses the number of threads, required memory, and walltime arguments along with the confirmed left and right files to use to write the qsub script.  If single-ended reads are being used, they are treated as left arguments in Trinity.  If \"-n\" is used in the command, the Trinity argument \" --normalize_reads\" is added.  All output from Trinity is written to the receipt.  The .qsub file is saved in the output directory.  The final assembly is saved in Trinity.fasta.\r\n\r\n###A few notes about Trinity:\r\nSince Trinity modifies the original files in the original directory it is crucial to only run one job per input directory at a time.  If a job times out or fails it can be restarted provided the user has not deleted any data Trinity has produced.\r\n\r\n####Resources:\r\n* <a href=\"http://trinityrnaseq.sourceforge.net\" target=\"_blank\">Trinity home page</a>\r\n</div>\r\n\r\n<a href=\"#top\">Back to the top</a>\r\n\r\n<br>\r\n##Step 3- RSEM quantification\r\n<a name=\"step3\"></a>\r\n\r\n***\r\n\r\n###Overview:\r\n\r\nPerforms alignment and abundance estimation using RSEM provided by Trinity.\r\n\r\n###Command Arguments:\r\n* `-h`, `--help`\r\n\r\n    Display help message and exit.\r\n\r\n* `--ref` \\<filepath\\>\r\n\r\n    Path to reference file (.fasta).\r\n\r\n* `--left` \\<filepath\\>\r\n\r\n    Path to left read file (R1).\r\n\r\n* `--right` \\<filepath\\>\r\n\r\n    Path to right read file (R2).\r\n\r\n* `-o`, `--outputdir` \\<path\\>\r\n\r\n    Name of output directory.  Does not have to be created prior to runtime.\r\n\r\n* `-t`, `--threads` \\<int\\>\r\n\r\n    Number of threads requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-r`, `--reqmem` \\<int\\>\r\n\r\n    Gb of memory requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-w`, `--walltime` \\<(h)h:mm:ss\\>\r\n\r\n    Estimated time required for job.  Enter as \"(h)h:mm:ss\".  Incorrect syntax will result in an error message followed by termination of the program. Default is 20:00:00.\r\n\r\n\r\n###Process:\r\n\r\nElectric EelPond Step 3 takes in two input files, a left and a right read (from step 1), and performs abundance estimation using a reference database file (Trinity.fasta from step 2).\r\n\r\nGenerated output files are placed in the output directory. Output from the program is placed in receipt.txt.\r\n\r\nStep 3 prompts for user confirmation of the input arguments before submitting to the HPCC.\r\n\r\n####Resources:\r\n\r\n* <a href=\"http://trinityrnaseq.sourceforge.net/analysis/abundance_estimation.html\" target=\"_blank\">Trinity abundance estimation</a>\r\n</div>\r\n\r\n<a href=\"#top\">Back to the top</a>\r\n\r\n<br>\r\n##Step 4- mpiBLAST\r\n<a name=\"step4\"></a>\r\n\r\n***\r\n\r\n###The Command Arguments:\r\n* `-h`, `--help`\r\n\r\n    Display help message and exit.\r\n\r\n* `-b`, `--blasttype` \\<string\\>\r\n\r\n    Type of blast to perform.  Choose from:\r\n \r\n    * blastp (amino acid query sequence against a protein sequence database)\r\n\r\n    * blastn (nucleotide query sequence against a nucleotide sequence database)\r\n\r\n    * blastx (nucleotide query sequence translated in all reading frames against a protein sequence database)\r\n\r\n    * tblastn (protein query sequence against a nucleotide sequence database dynamically translated in all reading frames)\r\n\r\n    * tblastx (compares the six-frame translations of a nucleotide query sequence against the six-frame translations of a nucleotide sequence database. Please note that tblastx program cannot be used with the nr database on the BLAST Web page. )\r\n\r\n* `-i`, `--input` \\<filepath\\>\r\n\r\n    Name of input query to search against database.  Include entire path in argument.\r\n\r\n* `-d`, `--database` \\<string\\>\r\n\r\n    Name of database. Do not include path.\r\n\r\n* `-o`, `--outputdir` \\<path\\>\r\n\r\n    Name of output directory.  Does not have to be created prior to runtime.\r\n\r\n* `-t`, `--threads` \\<int\\>\r\n\r\n    Number of threads requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-r`, `--reqmem` \\<int\\>\r\n\r\n    Gb of memory requested.  Enter as a digit. Incorrect syntax will result in an error message followed by termination of the program.\r\n\r\n* `-w`, `--walltime` \\<(h)h:mm:ss\\>\r\n\r\n    Estimated time required for job.  Enter as \"(h)h:mm:ss\".  Incorrect syntax will result in an error message followed by termination of the program. Default is 20:00:00.\r\n\r\n* `-n`, `--nodes` \\<int\\>\r\n\r\n    Number of nodes requested.\r\n\r\n\r\n###The Process:\r\nElectric Eelpond calls the mpiBLAST exec command to BLAST the data against a chosen database.  mpiBLAST takes advantage of parallel computing to process fragments of a database simultaneously using multiple nodes.  Before Electric Eelpond Step 4 can be run, the user must fragment the database into a chosen directory and create a .ncbirc file in his/her home directory.\r\n\r\n####Fragmenting the Database:\r\nTo fragment a database into N (number of) fragments, enter these commands:\r\n\r\n```\r\nmodule load mpiBLAST\r\n```\r\n\r\n```\r\nmpiformatdb -N [number of fragments] -i [name of database] -o T -n [path/to/fragment/directory] -p [T if protein database/F if nucleotide database]\r\n```\r\n\r\nIn the fragment directory you should now see the fragments of the database.\r\n\r\n####Creating the .ncbirc File:\r\nIn your home directory, create a .ncbirc file with the following lines:\r\n\r\n```\r\n[NCBI]\r\nData=/opt/software/mpiBLAST/mpiblast-1.6.0/ncbi/data\r\n[BLAST]\r\nBLASTDB=/path/to/fragments/directory\r\nBLASTMAT=/opt/software/mpiBLAST/mpiblast-1.6.0/ncbi/data\r\n[mpiBLAST]\r\nShared=/path/to/fragments/directory\r\nLocal=/path/to/temp/directory\r\n```\r\n\r\nCheck that BLASTDB and SHARED are both the path to the fragments created using the above mpiformatdb command.  LOCAL will be created in the mpiBLAST exec command and deleted after finishing.  It is recommended that the user stores the LOCAL (temporary) directory in /mnt/scratch for easy file managment.\r\n\r\n####Running Electric Eelpond Step 4:\r\nAfter the database has been fragmented into the [mpiBLAST] Shared directory and the .ncbirc file has been created in the home directory, Electric Eelpond Step 4 can commence.  Request at least (2 + number of database fragments) nodes, and at least (2 + number of database fragments) Gb memory.  Request appropriately more memory for larger databases.  \r\nWhen inputting the `-d` argument, enter only the root name of your database, not the entire path name.  The .ncbirc file, if formatted correctly, will tell mpiBLAST exactly how to access the fragmented database.\r\nThe JobID will be the same name as the output directory.\r\n\r\n####The Output:\r\nAfter mpiBLAST finishes, the output directory should contain a time.txt, results.txt, error.txt, and output.txt in addition to the BLAST.qsub and receipt.txt.  The results.txt file contains the blast hit data.  output.txt contains information about the resources requested and required.\r\n\r\n###Resources:\r\n<a href=\"https://wiki.hpcc.msu.edu/display/Bioinfo/Using+mpiBLAST\" target=\"_blank\">HPCC tutorial: Using mpiBLAST</a>\r\n\r\n<a href=\"http://www.ncbi.nlm.nih.gov/BLAST/blast_program.shtml\" target=\"_blank\">BLAST programs</a>\r\n\r\n<a href=\"http://blast.ncbi.nlm.nih.gov/Blast.cgi\" target=\"_blank\">BLAST website</a>\r\n\r\n<a href=\"#top\">Back to the top</a>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}